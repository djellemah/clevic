<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link rel="stylesheet" href="stylesheets/screen.css" type="text/css" media="screen" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
      Clevic
  </title>
<style>

</style>
  <script type="text/javascript">
    window.onload = function() {
      settings = {
          tl: { radius: 10 },
          tr: { radius: 10 },
          bl: { radius: 10 },
          br: { radius: 10 },
          antiAlias: true,
          autoPad: true,
          validTags: ["div"]
      }
    }
  </script>
</head>
<body>

<div id="main">
	<h1>Clevic</h1>
	<p><a href="rdoc">RDoc</a> | <a href="http://rubygems.org/gems/clevic">Rubygems Page</a> | <a href="http://rubyforge.org/projects/clevic/">Rubyforge Project</a> | <a href="http://gitweb.semiosix.com/clevic">gitweb</a> | <a href="git://semiosix.com/clevic">git clone git://semiosix.com/clevic</a></p>
<p>Clevic is a toolkit for building GUIs database tables with useful functionality. It works with Qt or Java/Swing and <a href="http://sequel.rubyforge.org">Sequel</a>.<br />
An interesting side-effect of this will probably be that building form-style GUIs will be possible. Eventually. When the code has been written.<br />
Lots more in the <a href="rdoc">RDoc</a> pages.</p>
<p>Screenshot of a fully defined UI with the foreign-key dropdown in place. Tabs contain the two tables.</p>
<p>See <a href="rdoc">RDoc</a> for feature list.</p>
<p>See <a href="rdoc/Clevic/ModelBuilder.html">ModelBuilder</a> for how to define views.</p>
<p><img src="screenshot.png" title="Screenshot" alt="Screenshot" /></p>
<p>Code for minimal UI definition. Clevic will create a fairly sensible UI from the DB metadata.</p>
<pre><code>
require 'clevic.rb'

# see sql/accounts.sql for schema

# db connection
Sequel.connect( "postgres://#{host}/accounts_test?user=#{$options[:username] || 'accounts'}&amp;password=#{$options[:password]}" )

# minimal definition to get combo boxes to show up
class Entry &lt; Sequel::Model
  include Clevic::Record
  many_to_one :debit, :class_name =&gt; 'Account', :foreign_key =&gt; 'debit_id'
  many_to_one :credit, :class_name =&gt; 'Account', :foreign_key =&gt; 'credit_id'
end

# minimal definition to get sensible values in combo boxes
class Account &lt; Sequel::Model
  include Clevic::Record
  def to_s; name; end
end

</code></pre>
<p>Code for a full definition. The Entry model has some code to<br />
update the credit and debit fields when the new item description<br />
is found in the table.</p>
<pre><code>
require 'clevic.rb'

host = ENV['PGHOST'] || 'localhost'
$options ||= {}

if respond_to?( :'jruby?' ) &amp;&amp; jruby?
  constring = "jdbc:postgresql://#{host}/accounts_test?user=#{$options[:username] || 'accounts'}&amp;password=general"
  puts "constring: #{constring.inspect}"
  Sequel.connect( constring )
else
  Sequel.connect( "postgres://#{host}/accounts_test?user=#{$options[:username] || 'accounts'}&amp;password=general" )
end

class Entry &lt; Sequel::Model
  belongs_to :debit, :class_name =&gt; 'Account', :foreign_key =&gt; 'debit_id'
  belongs_to :credit, :class_name =&gt; 'Account', :foreign_key =&gt; 'credit_id'
  
  include Clevic::Record
  
  define_ui do
    plain       :date, :sample =&gt; '88-WWW-99'
    distinct    :description do |f|
      f.conditions "now() - date &lt;= '1 year'"
      f.sample( 'm' * 26 )
      f.notify_data_changed = lambda do |entity_view, table_view, model_index|
        if model_index.entity.credit.nil? &amp;&amp; model_index.entity.debit.nil?
          entity_view.update_from_description( model_index )
          
          # move edit cursor to amount field
          table_view.selection_model.clear
          table_view.override_next_index( model_index.choppy( :column =&gt; :amount ) )
        end
      end
    end
    distinct :supplier
    relational  :debit, :display =&gt; 'name', :conditions =&gt; 'active = true', :order =&gt; 'lower(name)', :sample =&gt; 'Leilani Member Loan'
    relational  :credit, :display =&gt; 'name', :conditions =&gt; 'active = true', :order =&gt; 'lower(name)', :sample =&gt; 'Leilani Member Loan'
    plain       :amount, :sample =&gt; 999999.99
    distinct    :category
    plain       :cheque_number
    plain       :active, :sample =&gt; 'WW'
    plain       :vat, :label =&gt; 'VAT', :sample =&gt; 'WW', :tooltip =&gt; 'Does this include VAT?'
    
    records     :order =&gt; 'date, id'
  end
  
  # Copy the values for the credit and debit fields
  # from the previous similar entry with a similar description
  def self.update_from_description( current_index )
    return if current_index.attribute_value.nil?
    # most recent entry, ordered in reverse
    similar = self.adaptor.find(
      :first,
      :conditions =&gt; ["#{current_index.attribute} = ?", current_index.attribute_value],
      :order =&gt; 'date desc'
    )
    if similar != nil
      # set the values
      current_index.entity.debit = similar.debit
      current_index.entity.credit = similar.credit
      current_index.entity.category = similar.category
      
      # emit signal to that whole row has changed
      current_index.model.data_changed do |change|
        change.top_left = current_index.choppy( :column =&gt; 0 )
        change.bottom_right = current_index.choppy( :column =&gt; current_index.model.column_count - 1 )
      end
    end
  end
end

class Account &lt; Sequel::Model
  has_many :debits, :class_name =&gt; 'Entry', :foreign_key =&gt; 'debit_id'
  has_many :credits, :class_name =&gt; 'Entry', :foreign_key =&gt; 'credit_id'
  
  include Clevic::Record
  
  # define how fields are displayed
  define_ui do
    plain       :name
    restricted  :vat, :label =&gt; 'VAT', :set =&gt; %w{ yes no all }
    restricted  :account_type, :set =&gt; %w{Account Asset Assets Expenses Income Liability Opening Balance Personal Tax VAT}
    plain       :pastel_number, :alignment =&gt; Qt::AlignRight, :label =&gt; 'Pastel'
    plain       :fringe, :format =&gt; "%.1f"
    plain       :active
    
    records  :order =&gt; 'name,account_type'
  end
end

</code></pre>
</div>

<!-- insert site tracking codes here, like Google Urchin -->

</body>
</html>
