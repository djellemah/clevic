#! /usr/bin/ruby

require 'Qt4'
require 'entry_table_model.rb'
require 'delegates.rb'
require 'entry_table_view.rb'

require 'accounts_models.rb'

# last 100 entries in table
entries = Entry.find(
  :all,
  :order => 'id desc'
)
entries.reverse!

app = Qt::Application.new( ARGV )

table = EntryTableView.new
table.model = EntryTableModel.new(
  entries,
  %w{date description debit.name credit.name amount cheque_number active vat}
)

# fetch list from related tables
table.relational_delegate( :debit, :class_name => 'Account', :order => 'lower(name)' )
table.relational_delegate( :credit, :class_name => 'Account', :order => 'lower(name)' )

# fetch list from column
table.delegate( :description, DistinctDelegate )

#~ table.showMaximized
table.show

begin
  app.exec
rescue Exception => e
  puts e.backtrace.join( "\n" )
  puts e.message
end
